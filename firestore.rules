rules_version = '2';
service cloud.firestore {
  match /databases/{database}/documents {
    // Reglas específicas para solicitudes de cambio de datos
    match /changeRequests/{requestId} {
      // Cualquiera puede CREAR solicitudes (los estudiantes las crean)
      allow create: if true;
      // Cualquiera puede LEER (para que los estudiantes vean sus solicitudes)
      allow read: if true;
      // Solo usuarios autenticados pueden ACTUALIZAR (admins aprueban/rechazan)
      allow update, delete: if request.auth != null;
    }
    
    // Reglas para progreso de estudiantes (gamificación)
    match /studentProgress/{progressId} {
      // Cualquiera puede LEER su progreso
      allow read: if true;
      // Solo usuarios autenticados pueden ESCRIBIR (sistema actualiza automáticamente)
      allow write: if request.auth != null;
    }
    
    // Regla global:
    // - Cualquiera puede LEER (necesario para el Portal de Alumno)
    // - Solo Administradores autenticados pueden ESCRIBIR/MODIFICAR
    match /{document=**} {
      allow read: if true;
      allow write: if request.auth != null;
    }
  }
}